(()=>{"use strict";var t={86:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(a,o){function l(t){try{u(i.next(t))}catch(t){o(t)}}function r(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(l,r)}u((i=i.apply(t,e||[])).next())}))},a=this&&this.__generator||function(t,e){var n,i,a,o,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function r(r){return function(u){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(l=0)),l;)try{if(n=1,i&&(a=2&r[0]?i.return:r[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,r[1])).done)return a;switch(i=0,a&&(r=[2&r[0],a.value]),r[0]){case 0:case 1:a=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,i=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(!((a=(a=l.trys).length>0&&a[a.length-1])||6!==r[0]&&2!==r[0])){l=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){l.label=r[1];break}if(6===r[0]&&l.label<a[1]){l.label=a[1],a=r;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(r);break}a[2]&&l.ops.pop(),l.trys.pop();continue}r=e.call(t,l)}catch(t){r=[6,t],i=0}finally{n=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,u])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.EngagmentOpportunityForm=void 0;var o=n(903),l=function(){function t(){var e=this;this.OnLoad=function(n){var i,a,o,l,r,u,s=n.getFormContext();null===(i=s.data.entity)||void 0===i||i.addOnPostSave(e.onPostSave),s.ui.clearFormNotification(t.NOTIFICATION_ID_PUBLISH_STATUS);var c=s.getAttribute("msnfp_locationtype");null==c||c.addOnChange(e.setVisibilityLocationType),c.fireOnChange(),null===(a=s.getAttribute("msnfp_startingdate"))||void 0===a||a.addOnChange(e.onScheduleDateChanges),null===(o=s.getAttribute("msnfp_endingdate"))||void 0===o||o.addOnChange(e.onScheduleDateChanges);var g=s.getAttribute("msnfp_multipledays");null==g||g.addOnChange(e.onScheduleDateChanges),g.fireOnChange();var f=s.getAttribute("msnfp_shifts");null==f||f.addOnChange(e.onChangeShifts),f.fireOnChange(),null===(l=s.getAttribute("msnfp_minimum"))||void 0===l||l.addOnChange(e.ValidateMinAndMaxParticipants),null===(r=s.getAttribute("msnfp_maximum"))||void 0===r||r.addOnChange(e.ValidateMinAndMaxParticipants),null===(u=s.getAttribute("msnfp_automaticallyapproveallapplicants"))||void 0===u||u.addOnChange(e.onChangeAutoApproveAsync);var d=1===s.ui.getFormType();s.ui.tabs.forEach((function(t){"tab_createdraft"===t.getName()?t.setVisible(d):t.setVisible(!d)})),d&&!(null==g?void 0:g.getValue())&&(null==g||g.setValue(t.DEFAULT_MULTIPLE_DAYS))},this.OnSaveAsync=function(t){return i(e,void 0,void 0,(function(){var e,n,i,l,r,u,s,c,g,f,d,m;return a(this,(function(a){switch(a.label){case 0:return e=t.getFormContext(),null===(f=t.getEventArgs())||void 0===f||f.disableAsyncTimeout(),0===(null===(m=null===(d=e.getControl("Schedules"))||void 0===d?void 0:d.getGrid())||void 0===m?void 0:m.getTotalRecordCount())?[2]:(n=70===t.getEventArgs().getSaveMode(),i=e.getAttribute("msnfp_shifts"),l=null==i?void 0:i.getValue(),r=!0===(null==i?void 0:i.getIsDirty()),u=2===e.ui.getFormType(),r&&!l&&u?(s=n?" (".concat((0,o.getLocalizedText)("EngagementOpportunity.Schedule.Shifts.ShiftDeactivationDialog.TitleSuffix"),")"):"",c={title:"".concat((0,o.getLocalizedText)("EngagementOpportunity.Schedule.Shifts.ShiftDeactivationDialog.Title")).concat(s),text:(0,o.getLocalizedText)("EngagementOpportunity.Schedule.Shifts.ShiftDeactivationDialog.Text")},g={height:200,width:450},[4,Xrm.Navigation.openConfirmDialog(c,g)]):[3,2]);case 1:if(!0!==a.sent().confirmed)return t.getEventArgs().preventDefault(),[2];a.label=2;case 2:return[2]}}))}))},this.onPostSave=function(t){e.setShiftsVisibility(t)},this.setVisibilityLocationType=function(t){var n,i,a=t.getFormContext(),o=null===(n=a.getAttribute("msnfp_locationtype"))||void 0===n?void 0:n.getValue(),l=!0,r=!0;switch(o){case 84406e4:l=!0,r=!1;break;case 844060001:l=!1,r=!0;break;case 844060002:l=!0,r=!0;break;case 844060003:l=!1,r=!1}e.setVisibleOnLocationFields(a,l),null===(i=a.getAttribute("msnfp_url"))||void 0===i||i.controls.forEach((function(t){return t.setVisible(r)}))},this.validateScheduleEndIsNotGreaterThanStart=function(t,e){var n,i,a=null!==(n=null==t?void 0:t.getValue())&&void 0!==n?n:null,l=null!==(i=null==e?void 0:e.getValue())&&void 0!==i?i:null;a&&l&&a>l?e.controls.forEach((function(t){return t.setNotification((0,o.getLocalizedText)("EngagementOpportunity.Schedule.EndDate.EndDateValidationText"),"")})):null==e||e.controls.forEach((function(t){return t.clearNotification()}))},this.setScheduleEndDateIfNull=function(t,n,i,a){var o,l,r=null!==(o=null==n?void 0:n.getValue())&&void 0!==o?o:null,u=null!==(l=null==i?void 0:i.getValue())&&void 0!==l?l:null;t||!r||u||null==i||i.setValue(e.getEndOfDayForDate(r,a))},this.setEndOfDayForSingleDaySchedule=function(t,n,i,a){var o,l,r=null!==(o=null==n?void 0:n.getValue())&&void 0!==o?o:null,u=null!==(l=null==i?void 0:i.getValue())&&void 0!==l?l:null;if(!t&&r){var s=e.getEndOfDayForDate(r,a),c=e.areDatesAtSameDay(r,u);r<=u&&u<=s||c||i.setValue(s)}},this.onScheduleDateChanges=function(n){var i=n.getFormContext(),a=n.getEventSource(),o=i.getAttribute("msnfp_multipledays"),l=a&&"msnfp_multipledays"===a.getName(),r=a&&"msnfp_endingdate"===a.getName(),u=i.getAttribute("msnfp_startingdate"),s=i.getAttribute("msnfp_endingdate"),c=Xrm.Utility.getGlobalContext().userSettings.getTimeZoneOffsetMinutes()*t.ONE_MINUTE_MS;e.setScheduleEndDateIfNull(!0===(null==o?void 0:o.getValue()),u,s,c),!r&&l&&e.setEndOfDayForSingleDaySchedule(!0===(null==o?void 0:o.getValue()),u,s,c);var g=!0===(null==o?void 0:o.getValue()),f=null==u?void 0:u.getValue(),d=null==s?void 0:s.getValue();if(f&&d&&!l){var m=e.areDatesAtSameDay(f,d);g&&m?null==o||o.setValue(!1):g||m||null==o||o.setValue(!0)}e.validateScheduleEndIsNotGreaterThanStart(u,s)},this.onChangeShifts=function(n){var i,a,l=n.getFormContext(),r=l.getAttribute("msnfp_shifts"),u=!0===(null==r?void 0:r.getValue()),s=!0===(null==r?void 0:r.getIsDirty());null===(i=l.getAttribute("msnfp_minimum"))||void 0===i||i.controls.forEach((function(t){return t.setDisabled(u)})),null===(a=l.getAttribute("msnfp_maximum"))||void 0===a||a.controls.forEach((function(t){return t.setDisabled(u)})),e.setShiftsVisibility(n),u&&s&&l.ui.setFormNotification((0,o.getLocalizedText)("EngagementOpportunity.Schedule.Shifts.EnablementNotificationText"),"INFO",t.NOTIFICATION_ID_SHIFTS_CHANGED)},this.setShiftsVisibility=function(e){var n,i,a=e.getFormContext(),o=a.getAttribute("msnfp_shifts"),l=!0===(null==o?void 0:o.getValue()),r=!0===(null==o?void 0:o.getIsDirty()),u=l;!0===l&&!0===r&&(u=!1),null===(i=null===(n=a.ui.tabs.get("tab_schedules"))||void 0===n?void 0:n.sections.get("Schedules_Schedules"))||void 0===i||i.setVisible(u),a.ui.clearFormNotification(t.NOTIFICATION_ID_SHIFTS_CHANGED)},this.setVisibleOnLocationFields=function(t,e){["msnfp_location","msnfp_street1","msnfp_street2","msnfp_street3","msnfp_city","msnfp_stateprovince","msnfp_zippostalcode","msnfp_country","msnfp_county"].forEach((function(n){var i;null===(i=t.getAttribute(n))||void 0===i||i.controls.forEach((function(t){return t.setVisible(e)}))}))},this.onChangeAutoApproveAsync=function(t){return i(e,void 0,void 0,(function(){var e,n,i,l;return a(this,(function(a){switch(a.label){case 0:e=t.getFormContext(),n={title:(0,o.getLocalizedText)("EngagementOpportunity.PostSettings.AutomaticallyApproveAllApplicants.AutomaticAproveDialog.Title"),text:(0,o.getLocalizedText)("EngagementOpportunity.PostSettings.AutomaticallyApproveAllApplicants.AutomaticAproveDialog.Text")},a.label=1;case 1:return a.trys.push([1,6,,7]),[4,Xrm.Navigation.openConfirmDialog(n,null)];case 2:return a.sent().confirmed?[4,e.data.save()]:[3,4];case 3:return a.sent(),[3,5];case 4:(i=e.getAttribute("msnfp_automaticallyapproveallapplicants")).setValue(!i.getValue()),a.label=5;case 5:return[3,7];case 6:return l=a.sent(),Xrm.Navigation.openErrorDialog({message:l}),[3,7];case 7:return[2]}}))}))},this.PublishFromRibbon=function(e,n,i,a,l){void 0===l&&(l=(0,o.getLocalizedText)("EngagementOpportunity.PublishEngagementOpportunity.ConfirmButtonText")),Xrm.Navigation.openConfirmDialog({text:(0,o.getLocalizedText)(i),title:(0,o.getLocalizedText)(a),confirmButtonLabel:l},null).then((function(i){i.confirmed&&(e.getAttribute("msnfp_engagementopportunitystatus").setValue(n),e.data.save(),e.ui.setFormNotification((0,o.getLocalizedText)("EngagementOpportunity.PublishEngagementOpportunity.FormNotificationText"),"INFO",t.NOTIFICATION_ID_PUBLISH_STATUS))}))},this.OpenQuickCreateFromSubgridRibbon=function(t,e){var n=e[0];Xrm.Navigation.openForm({entityName:"msnfp_participationschedule",createFromEntity:{entityType:"msnfp_participation",id:n.Id},useQuickCreateForm:!0})},this.getEndOfDayForDate=function(e,n){if(void 0===n&&(n=0),!e)return null;var i=e.getTime()+n,a=t.ONE_DAY_MS-i%t.ONE_DAY_MS;return new Date(e.getTime()+a-t.ONE_MILLISECOND)},this.areDatesAtSameDay=function(t,e){return!(!t||!e)&&t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()},this.ValidateMinAndMaxParticipants=function(t){var e=t.getFormContext();e.getControl("msnfp_minimum").clearNotification(),e.getControl("msnfp_maximum").clearNotification();var n=e.getAttribute("msnfp_minimum").getValue(),i=e.getAttribute("msnfp_maximum").getValue();null===n&&null===i||(null!==n&&null===i&&(e.getAttribute("msnfp_maximum").setValue(n),i=n),null!==n||null===i?n>i&&e.getControl("msnfp_maximum").setNotification((0,o.getLocalizedText)("EngagementOpportunity.Schedule.Maximum.MaximumValueValidationText")):e.getControl("msnfp_minimum").setNotification((0,o.getLocalizedText)("EngagementOpportunity.Schedule.Minimum.MinimumValueValidationText")))}}return t.NOTIFICATION_ID_SHIFTS_CHANGED="msnfp_shifts_changed",t.NOTIFICATION_ID_PUBLISH_STATUS="StatusUpdateConfirmationMessage",t.DEFAULT_MULTIPLE_DAYS=!1,t.ONE_DAY_MS=864e5,t.ONE_MINUTE_MS=6e4,t.ONE_MILLISECOND=1,t}();e.EngagmentOpportunityForm=l,window.EngagmentOpportunityForm=new l},903:function(t,e){var n=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var i,a=0,o=e.length;a<o;a++)!i&&a in e||(i||(i=Array.prototype.slice.call(e,0,a)),i[a]=e[a]);return t.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.getLocalizedText=e.formatDateTime=void 0;var i=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t.replace(/{(\d+)}/g,(function(t,n){var i=parseInt(n);return void 0===e[i]?t:e[i]}))};e.formatDateTime=function(t,e){var n;if(!t||!e||!t.localeFormat)return null!==(n=null==t?void 0:t.toLocaleString())&&void 0!==n?n:"";var i=e.ShortDatePattern.replace(/\//gi,e.DateSeparator),a=e.ShortTimePattern.replace(/:/gi,e.TimeSeparator);return"".concat(t.localeFormat(i)," ").concat(t.localeFormat(a))},e.getLocalizedText=function(t){for(var e=[],a=1;a<arguments.length;a++)e[a-1]=arguments[a];var o=Xrm.Utility.getResourceString("msnfp_/strings/VolunteerManagement.Webresources",t);return o?i.apply(void 0,n([o],e,!1)):t}}},e={};!function n(i){var a=e[i];if(void 0!==a)return a.exports;var o=e[i]={exports:{}};return t[i].call(o.exports,o,o.exports,n),o.exports}(86)})();