(()=>{"use strict";var t={187:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{l(i.next(t))}catch(t){r(t)}}function u(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}l((i=i.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function u(u){return function(l){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,u[0]&&(a=0)),a;)try{if(n=1,i&&(o=2&u[0]?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,i=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],i=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,l])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.EngagementOpportunityScheduleForm=void 0;var r=n(903),a=function(){var t=this;this.opportunityStartDate=void 0,this.opportunityEndDate=void 0,this.opportunityShiftsEnabled=void 0,this.OnLoad=function(e){var n,i,o=e.getFormContext();o.data.entity.addOnPostSave(t.onPostSave);var r=o.getAttribute("msnfp_engagementopportunity");null==r||r.addOnChange(t.onOpportunityChange),null==r||r.fireOnChange(),null===(n=o.getAttribute("msnfp_effectivefrom"))||void 0===n||n.addOnChange(t.onScheduleDateChange),null===(i=o.getAttribute("msnfp_effectiveto"))||void 0===i||i.addOnChange(t.onScheduleDateChange),t.setVisibilityBasedOnFormType(e)},this.setVisibilityBasedOnFormType=function(t){var e,n=t.getFormContext(),i=[1,5].includes(n.ui.getFormType()),o=2===n.ui.getFormType();["msnfp_hours","msnfp_number"].forEach((function(t){var e;null===(e=n.getAttribute(t))||void 0===e||e.controls.forEach((function(t){return t.setVisible(!i)}))})),null===(e=n.getAttribute("msnfp_engagementopportunity"))||void 0===e||e.controls.forEach((function(t){return t.setDisabled(o)}));var r=n.getAttribute("msnfp_engagementopportunity");i&&r&&!r.getValue()&&r.controls.forEach((function(t){return t.setVisible(!0)}))},this.onPostSave=function(e){t.setVisibilityBasedOnFormType(e)},this.onOpportunityChange=function(e){return i(t,void 0,void 0,(function(){var t,n,i;return o(this,(function(o){switch(o.label){case 0:return t=e.getFormContext(),n=null===(i=t.getAttribute("msnfp_engagementopportunity"))||void 0===i?void 0:i.getValue(),[4,this.reloadOpportunityDetailsAsync(n)];case 1:return o.sent(),this.setMinMaxEnablement(e),this.onScheduleDateChange(e),[2]}}))}))},this.reloadOpportunityDetailsAsync=function(e){return i(t,void 0,void 0,(function(){var t,n,i,a,u;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,4]),e&&0!==e.length?[4,Xrm.WebApi.retrieveRecord(e[0].entityType,e[0].id,"?$select=msnfp_shifts,msnfp_startingdate,msnfp_endingdate")]:(this.opportunityShiftsEnabled=void 0,this.opportunityStartDate=void 0,this.opportunityEndDate=void 0,[2]);case 1:return t=o.sent(),n=t.msnfp_shifts,i=t.msnfp_startingdate,a=t.msnfp_endingdate,this.opportunityShiftsEnabled=n,this.opportunityStartDate=i&&new Date(i),this.opportunityEndDate=a&&new Date(a),[3,4];case 2:return u=o.sent(),[4,Xrm.Navigation.openErrorDialog({message:(0,r.getLocalizedText)("EngagementOpportunitySchedule.General.EngagementOpportunity.RelatedOpportunityLoadErrorText"),details:u})];case 3:return o.sent(),[3,4];case 4:return[2]}}))}))},this.setMinMaxEnablement=function(e){var n,i,o,r,a=e.getFormContext();void 0===t.opportunityShiftsEnabled&&(t.opportunityShiftsEnabled=!1,null===(n=a.getAttribute("msnfp_minimum"))||void 0===n||n.setValue(null),null===(i=a.getAttribute("msnfp_maximum"))||void 0===i||i.setValue(null)),null===(o=a.getAttribute("msnfp_minimum"))||void 0===o||o.controls.forEach((function(e){return e.setDisabled(!t.opportunityShiftsEnabled)})),null===(r=a.getAttribute("msnfp_maximum"))||void 0===r||r.controls.forEach((function(e){return e.setDisabled(!t.opportunityShiftsEnabled)}))},this.onScheduleDateChange=function(e){var n=e.getFormContext(),i=n.getAttribute("msnfp_effectivefrom"),o=n.getAttribute("msnfp_effectiveto");i&&o&&(t.setScheduleEndDateIfNull(i,o),t.validateShiftIsWithInEoDateRange(i,o)&&t.validateScheduleEndIsNotGreaterThanStart(i,o))},this.setScheduleEndDateIfNull=function(t,e){var n,i,o=null!==(n=null==t?void 0:t.getValue())&&void 0!==n?n:null,r=null!==(i=null==e?void 0:e.getValue())&&void 0!==i?i:null;o&&!r&&(null==e||e.setValue(o))},this.validateScheduleEndIsNotGreaterThanStart=function(t,e){var n,i,o=null!==(n=null==t?void 0:t.getValue())&&void 0!==n?n:null,a=null!==(i=null==e?void 0:e.getValue())&&void 0!==i?i:null;return o&&a&&o>a?(e.controls.forEach((function(t){return t.setNotification((0,r.getLocalizedText)("EngagementOpportunitySchedule.General.EndDate.EndDateValidationText"),"")})),!1):(null==e||e.controls.forEach((function(t){return t.clearNotification()})),!0)},this.validateShiftIsWithInEoDateRange=function(e,n){var i=null==e?void 0:e.getValue(),o=null==n?void 0:n.getValue(),a=Xrm.Utility.getGlobalContext().userSettings.dateFormattingInfo,u=(0,r.getLocalizedText)("EngagementOpportunitySchedule.General.EffectiveDateRangeValidationText",(0,r.formatDateTime)(t.opportunityStartDate,a),(0,r.formatDateTime)(t.opportunityEndDate,a)),l=t.isScheduleWithinEoDateRange(i),s=i&&t.opportunityStartDate&&!l?u:void 0;null==e||e.controls.forEach((function(t){s?t.setNotification(s,""):t.clearNotification()}));var c=t.isScheduleWithinEoDateRange(o),p=o&&t.opportunityEndDate&&!c?u:void 0;return null==n||n.controls.forEach((function(t){p?t.setNotification(p,""):t.clearNotification()})),!s&&!p},this.isScheduleWithinEoDateRange=function(e){return e>=t.opportunityStartDate&&e<=t.opportunityEndDate}};e.EngagementOpportunityScheduleForm=a,window.EngagementOpportunityScheduleForm=new a},903:function(t,e){var n=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var i,o=0,r=e.length;o<r;o++)!i&&o in e||(i||(i=Array.prototype.slice.call(e,0,o)),i[o]=e[o]);return t.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.getLocalizedText=e.formatDateTime=void 0;var i=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t.replace(/{(\d+)}/g,(function(t,n){var i=parseInt(n);return void 0===e[i]?t:e[i]}))};e.formatDateTime=function(t,e){var n;if(!t||!e||!t.localeFormat)return null!==(n=null==t?void 0:t.toLocaleString())&&void 0!==n?n:"";var i=e.ShortDatePattern.replace(/\//gi,e.DateSeparator),o=e.ShortTimePattern.replace(/:/gi,e.TimeSeparator);return"".concat(t.localeFormat(i)," ").concat(t.localeFormat(o))},e.getLocalizedText=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];var r=Xrm.Utility.getResourceString("msnfp_/strings/VolunteerManagement.Webresources",t);return r?i.apply(void 0,n([r],e,!1)):t}}},e={};!function n(i){var o=e[i];if(void 0!==o)return o.exports;var r=e[i]={exports:{}};return t[i].call(r.exports,r,r.exports,n),r.exports}(187)})();